<% content_for :head do %>
	<%= javascript_include_tag 'jquery' %>
	<%= javascript_include_tag 'jquery.preload' %>
	
	<script type="text/javascript">
		function initialize()
		{
			$.preload('.big-images img', {
				placeholder:"<%= image_path('big_missing.jpg') %>",
				notFound:"<%= image_path('big_missing.jpg') %>"
			});
		}
		$(document).ready(initialize);
	</script>
<% end %>

<div id="main">
	<% form_for :query, @query, :url => { :action => :catalog }, :id => "main_form" do |f| %>
	<div class="line">
		<p class="main-header">Поиск по каталогу</p>
		<div class="search-controls">
			<span class="forselect search-select">
				<%= f.select("cost", @search.prices.collect {|p| [p.title, p.title] }, {:include_blank => 'Стоимость' }) %>
				<script type="text/javascript">
						new Select('query_cost', {width:130});
				</script>
				<span class="doDisable">
					<img width="1" height="1" alt="" src="images/pix-transpar.gif"/>
				</span>
			</span>
			<span class="forselect search-select">
				<%= f.select("location", @search.locations.find(:all).collect {|p| [p.title, p.title] }, {:include_blank => 'Расположение' }) %>
				<script type="text/javascript">
						new Select('query_location', {width:130});
				</script>
				<span class="doDisable">
					<img width="1" height="1" alt="" src="images/pix-transpar.gif"/>
				</span>
			</span>
			<span class="forselect search-select">
				<%= f.select("number", @search.numbers.collect {|p| [p.title, p.title] }, {:include_blank => 'Количество мест' }) %>
				<script type="text/javascript">
						new Select('query_number', {width:130});
				</script>
				<span class="doDisable">
					<img width="1" height="1" alt="" src="images/pix-transpar.gif"/>
				</span>
			</span>	
			<span class="search-top-button">
				<input type="submit" id="submit-button-hidden" class="hidden" />
				<span>
					<a href="#" onclick="var form = document.getElementById('submit-button-hidden'); form.click();">
						<%= image_tag('search2.png') %>
					</a>
				</span>
			</span>
			<span class="search-comment">
				сейчас в каталоге находится 24 виллы, 15 апартаментов и 31 бунгалс
			</span>
		</div>
	</div>
	<div id="content">
		<div>
			<% if @houses.size != 0 then %>
				<p class="search-header-title">
					<%= link_to "Все предложения", :controller => :main, :action => :catalog %>
				</p>
				<div class="clearer"></div>
				<% i = 0 %>
				<% for house in @houses %>
					<% if house.photos.size > 0 %>
						<% if i % 2 == 0 then %>
							<%= render :partial => 'big_image', :object => house.photos[i], :locals => { :frame_class => "left-column", :house_id => house.id } %>
						<% else %>
							<%= render :partial => 'big_image', :object => house.photos[i], :locals => { :frame_class => "right-column", :house_id => house.id } %>
						<% end %>
					<% end %>
					<% i += 1 %>
				<% end %>
			<% else %>
				<p>По вашему запросу ничего не найдено</p>
			<% end %>
		</div>
		<div class="clearer">&nbsp;</div>
	</div>
	<% end %>
</div>